<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barbershop - ‘±’§’¥’´’∂’´’Ω’ø÷Ä’°’ø’∏÷Ä’´ ’æ’°’∞’°’∂’°’Ø</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-form {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
        }

        .login-form h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
            font-size: 28px;
        }

        .login-error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
            display: none;
        }

        .login-blocked {
            background: #dc3545;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
            display: none;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e1e1;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .login-btn:hover {
            transform: translateY(-2px);
        }

        .login-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .admin-panel {
            display: none;
            min-height: 100vh;
            background: #f5f7fa;
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            height: 100vh;
            background: #2c3e50;
            color: white;
            padding: 20px 0;
            transition: transform 0.3s;
            z-index: 1000;
        }

        .sidebar.mobile-hidden {
            transform: translateX(-100%);
        }

        .sidebar-header {
            padding: 0 20px 30px;
            border-bottom: 1px solid #34495e;
        }

        .sidebar-header h3 {
            font-size: 20px;
            color: #ecf0f1;
        }

        .sidebar-menu {
            list-style: none;
            padding: 20px 0;
        }

        .sidebar-menu li {
            margin: 5px 0;
        }

        .sidebar-menu a {
            display: block;
            padding: 12px 20px;
            color: #bdc3c7;
            text-decoration: none;
            transition: all 0.3s;
        }

        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background: #34495e;
            color: #3498db;
            border-right: 3px solid #3498db;
        }

        .main-content {
            margin-left: 250px;
            padding: 20px;
            transition: margin-left 0.3s;
        }

        .main-content.full-width {
            margin-left: 0;
        }

        .header {
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .mobile-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #333;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 24px;
        }

        .logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: auto;
        }

        .page {
            display: none;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .page.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-card h3 {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .stat-card p {
            font-size: 16px;
            opacity: 0.9;
        }

        .stat-buttons {
            margin-top: 15px;
        }

        .stat-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 5px 10px;
            margin: 0 2px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
        }

        .stat-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .btn:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }

        .btn-success {
            background: #27ae60;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-warning {
            background: #f39c12;
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .btn-info {
            background: #17a2b8;
        }

        .btn-info:hover {
            background: #138496;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            position: relative;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            position: absolute;
            right: 15px;
            top: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .close:hover {
            color: #333;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #27ae60;
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 3000;
            transform: translateX(400px);
            transition: transform 0.3s;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #e74c3c;
        }

        .notification.warning {
            background: #f39c12;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .settings-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .settings-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #3498db;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .telegram-bot-card {
            background: white;
            border: 2px solid #e1e1e1;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .telegram-bot-card.connected {
            border-color: #27ae60;
            background: #f8fff8;
        }

        .telegram-bot-card.disconnected {
            border-color: #e74c3c;
            background: #fff8f8;
        }

        .bot-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }

        .status-indicator.active {
            background: #27ae60;
            animation: pulse 2s infinite;
        }

        .status-indicator.inactive {
            background: #e74c3c;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .reservation-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #3498db;
        }

        .reservation-pending {
            border-left-color: #f39c12;
        }

        .reservation-accepted {
            border-left-color: #27ae60;
        }

        .reservation-declined {
            border-left-color: #e74c3c;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state h3 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #999;
        }

        .empty-state p {
            font-size: 16px;
            color: #777;
        }

        /* Chat Styles */
        .chat-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            height: 600px;
        }

        .chat-users {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #e1e1e1;
        }

        .chat-users h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }

        .user-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .user-item {
            padding: 12px;
            margin-bottom: 8px;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .user-item:hover {
            background: #e3f2fd;
            border-color: #3498db;
        }

        .user-item.active {
            background: #3498db;
            color: white;
        }

        .user-item h5 {
            margin: 0 0 5px 0;
            font-size: 14px;
        }

        .user-item p {
            margin: 0;
            font-size: 12px;
            opacity: 0.7;
        }

        .chat-area {
            background: white;
            border-radius: 10px;
            border: 1px solid #e1e1e1;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            padding: 20px;
            border-bottom: 1px solid #e1e1e1;
            background: #f8f9fa;
            border-radius: 10px 10px 0 0;
        }

        .chat-header h4 {
            color: #2c3e50;
            margin: 0;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            max-height: 400px;
        }

        .message {
            margin-bottom: 15px;
            padding: 12px 15px;
            border-radius: 10px;
            max-width: 80%;
        }

        .message.sent {
            background: #3498db;
            color: white;
            margin-left: auto;
            text-align: right;
        }

        .message.received {
            background: #f1f3f4;
            color: #333;
        }

        .message-time {
            font-size: 11px;
            opacity: 0.7;
            margin-top: 5px;
        }

        .chat-input {
            padding: 20px;
            border-top: 1px solid #e1e1e1;
            background: #f8f9fa;
            border-radius: 0 0 10px 10px;
        }

        .chat-input-group {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .chat-input textarea {
            flex: 1;
            min-height: 40px;
            max-height: 120px;
            resize: vertical;
            border: 2px solid #e1e1e1;
            border-radius: 8px;
            padding: 10px;
            font-family: inherit;
        }

        .chat-input textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .send-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
        }

        .send-btn:hover {
            background: #2980b9;
        }

        .send-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }

        .chat-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #999;
            text-align: center;
        }

        .email-options {
            margin-top: 15px;
            padding: 15px;
            background: #e8f5e8;
            border-radius: 8px;
            border: 1px solid #c3e6c3;
        }

        .email-options h5 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .email-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Telegram Bot Settings Styles */
        .bot-settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .bot-setting-card {
            background: white;
            border: 1px solid #e1e1e1;
            border-radius: 10px;
            padding: 20px;
        }

        .bot-setting-card h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }

        .setting-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .setting-content {
            flex: 1;
            margin-right: 15px;
        }

        .setting-actions {
            display: flex;
            gap: 5px;
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
            margin: 2px;
        }

        /* Moderator Management Styles */
        .moderator-card {
            background: white;
            border: 1px solid #e1e1e1;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .moderator-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .moderator-info {
            flex: 1;
            margin-right: 15px;
        }

        .moderator-role {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-top: 5px;
        }

        .role-admin {
            background: #e74c3c;
            color: white;
        }

        .role-moderator {
            background: #f39c12;
            color: white;
        }

        .role-viewer {
            background: #95a5a6;
            color: white;
        }

        /* Reservation Popup */
        .reservation-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            z-index: 3000;
            max-width: 500px;
            width: 90%;
            animation: popupSlideIn 0.3s ease-out;
        }

        @keyframes popupSlideIn {
            from {
                opacity: 0;
                transform: translate(-50%, -60%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }

        .reservation-popup h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }

        .reservation-details {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .reservation-details p {
            margin-bottom: 10px;
            color: #555;
        }

        .reservation-details strong {
            color: #2c3e50;
        }

        .popup-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2999;
        }

        /* Telegram Bot Simulator */
        .bot-simulator {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #e1e1e1;
        }

        .bot-simulator h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }

        .bot-screen {
            background: white;
            border-radius: 10px;
            padding: 20px;
            min-height: 400px;
            border: 1px solid #ddd;
            position: relative;
        }

        .bot-message {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #2196f3;
        }

        .bot-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .bot-btn {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .bot-btn:hover {
            background: #1976d2;
        }

        .bot-image {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        /* Confirmation Dialog Styles */
        .confirmation-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            z-index: 3001;
            max-width: 400px;
            width: 90%;
            text-align: center;
            animation: popupSlideIn 0.3s ease-out;
        }

        .confirmation-dialog h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 20px;
        }

        .confirmation-dialog p {
            color: #666;
            margin-bottom: 25px;
            font-size: 16px;
        }

        .confirmation-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .confirmation-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 3000;
        }

        /* Auto-logout warning */
        .logout-warning {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #f39c12;
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 3002;
            text-align: center;
            min-width: 300px;
        }

        .logout-warning h4 {
            margin-bottom: 10px;
        }

        .logout-warning p {
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.mobile-show {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .mobile-toggle {
                display: block;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .table {
                font-size: 14px;
            }

            .table th,
            .table td {
                padding: 8px;
            }

            .chat-container {
                grid-template-columns: 1fr;
                height: auto;
            }

            .chat-users {
                max-height: 200px;
            }

            .chat-area {
                height: 500px;
            }

            .bot-settings-grid {
                grid-template-columns: 1fr;
            }

            .reservation-popup {
                width: 95%;
                padding: 20px;
            }

            .confirmation-dialog {
                width: 95%;
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 10px;
            }

            .modal-content {
                margin: 10% auto;
                padding: 20px;
            }

            .header {
                padding: 10px 15px;
            }

            .header h1 {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Form -->
    <div id="loginContainer" class="login-container">
        <form class="login-form" id="loginForm">
            <h2>üîê ‘±’§’¥’´’∂’´’Ω’ø÷Ä’°’ø’∏÷Ä’´ ’æ’°’∞’°’∂’°’Ø</h2>
            <div id="loginError" class="login-error"></div>
            <div id="loginBlocked" class="login-blocked"></div>
            <div class="form-group">
                <label for="password">‘≥’°’≤’ø’∂’°’¢’°’º:</label>
                <input type="password" id="password" required>
            </div>
            <button type="submit" class="login-btn" id="loginButton">’Ñ’∏÷Ç’ø÷Ñ ’£’∏÷Ä’Æ’•’¨</button>
        </form>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="admin-panel">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>üíà Barbershop</h3>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#" data-page="dashboard" class="active">üìä ’é’°’∞’°’∂’°’Ø</a></li>
                <li><a href="#" data-page="services">‚úÇÔ∏è ‘æ’°’º’°’µ’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä</a></li>
                <li><a href="#" data-page="users">üë• ’ï’£’ø’°’ø’•÷Ä’•÷Ä</a></li>
                <li><a href="#" data-page="reservations">üìÖ ‘±’¥÷Ä’°’£÷Ä’∏÷Ç’¥’∂’•÷Ä</a></li>
                <li><a href="#" data-page="chat">üí¨ Chat</a></li>
                <li><a href="#" data-page="settings">‚öôÔ∏è ‘ø’°÷Ä’£’°’æ’∏÷Ä’∏÷Ç’¥’∂’•÷Ä</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Header -->
            <header class="header">
                <button class="mobile-toggle" id="mobileToggle">‚ò∞</button>
                <h1 id="pageTitle">’é’°’∞’°’∂’°’Ø</h1>
                <button class="logout-btn" id="logoutBtn">‘µ’¨÷Ñ</button>
            </header>

            <!-- Dashboard Page -->
            <div id="dashboard" class="page active">
                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 id="totalUsers">0</h3>
                        <p>‘∏’∂’§’∞’°’∂’∏÷Ç÷Ä ÷Ö’£’ø’°’ø’•÷Ä’•÷Ä</p>
                        <div class="stat-buttons">
                            <button class="stat-btn" onclick="filterStats('users', 'daily')">’ï÷Ä’°’Ø’°’∂</button>
                            <button class="stat-btn" onclick="filterStats('users', 'weekly')">’á’°’¢’°’©’°’Ø’°’∂</button>
                            <button class="stat-btn" onclick="filterStats('users', 'monthly')">‘±’¥’Ω’°’Ø’°’∂</button>
                        </div>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalReservations">0</h3>
                        <p>‘∏’∂’§’∞’°’∂’∏÷Ç÷Ä ’°’¥÷Ä’°’£÷Ä’∏÷Ç’¥’∂’•÷Ä</p>
                        <div class="stat-buttons">
                            <button class="stat-btn" onclick="filterStats('reservations', 'daily')">’ï÷Ä’°’Ø’°’∂</button>
                            <button class="stat-btn" onclick="filterStats('reservations', 'weekly')">’á’°’¢’°’©’°’Ø’°’∂</button>
                            <button class="stat-btn" onclick="filterStats('reservations', 'monthly')">‘±’¥’Ω’°’Ø’°’∂</button>
                        </div>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalServices">0</h3>
                        <p>‘∏’∂’§’∞’°’∂’∏÷Ç÷Ä ’Æ’°’º’°’µ’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä</p>
                    </div>
                </div>
            </div>

            <!-- Services Page -->
            <div id="services" class="page">
                <button class="btn btn-success" onclick="openServiceModal()">‚ûï ‘±’æ’•’¨’°÷Å’∂’•’¨ ’Æ’°’º’°’µ’∏÷Ç’©’µ’∏÷Ç’∂</button>
                <div id="servicesContainer">
                    <!-- Services will be loaded here -->
                </div>
            </div>

            <!-- Users Page -->
            <div id="users" class="page">
                <div id="usersContainer">
                    <!-- Users will be loaded here -->
                </div>
            </div>

            <!-- Reservations Page -->
            <div id="reservations" class="page">
                <div id="reservationsList">
                    <!-- Reservations will be loaded here -->
                </div>
            </div>

            <!-- Chat Page -->
            <div id="chat" class="page">
                <div class="chat-container">
                    <!-- Users List -->
                    <div class="chat-users">
                        <h4>üí¨ Select User</h4>
                        <div class="user-list" id="chatUsersList">
                            <!-- Users will be loaded here -->
                        </div>
                    </div>

                    <!-- Chat Area -->
                    <div class="chat-area">
                        <div class="chat-header">
                            <h4 id="chatUserName">Select a user to start chatting</h4>
                        </div>
                        
                        <div class="chat-messages" id="chatMessages">
                            <div class="chat-placeholder">
                                <div>
                                    <h3>üí¨ Chat</h3>
                                    <p>Select a user from the left to start a conversation</p>
                                </div>
                            </div>
                        </div>

                        <div class="chat-input" id="chatInputArea" style="display: none;">
                            <div class="chat-input-group">
                                <textarea id="messageInput" placeholder="Type your message here..." rows="2"></textarea>
                                <button class="send-btn" onclick="sendMessage()">Send</button>
                            </div>
                            
                            <div class="email-options">
                                <h5>üìß Email Options</h5>
                                <div class="email-buttons">
                                    <button class="btn btn-info" onclick="sendEmail()">Send Email</button>
                                    <button class="btn btn-warning" onclick="replyToEmail()">Reply to Email</button>
                                    <button class="btn btn-success" onclick="viewEmailHistory()">Email History</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings" class="page">
                <!-- Moderator Management -->
                <div class="settings-section">
                    <h3>üë• Moderator Management</h3>
                    <div class="moderator-card">
                        <button class="btn btn-success" onclick="openModeratorModal()">‚ûï Add Moderator</button>
                        <div id="moderatorsContainer">
                            <!-- Moderators will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Telegram Bot Integration -->
                <div class="settings-section">
                    <h3>ü§ñ Telegram Bot Integration</h3>
                    <div id="telegramBotCard" class="telegram-bot-card disconnected">
                        <div class="bot-status">
                            <span id="botStatusIndicator" class="status-indicator inactive"></span>
                            <span id="botStatusText">Status: Passive</span>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Telegram Bot Token:</label>
                                <input type="text" id="telegramBotToken" placeholder="Enter your bot token">
                            </div>
                            <div class="form-group">
                                <label>Telegram ID:</label>
                                <input type="text" id="telegramId" placeholder="Enter your Telegram ID">
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <button class="btn btn-success" onclick="connectTelegramBot()">Connect Bot</button>
                            <button class="btn btn-warning" onclick="testTelegramBot()">Test Connection</button>
                            <button class="btn btn-danger" onclick="deleteTelegramBot()">Delete Bot</button>
                        </div>
                    </div>
                </div>

                <!-- Telegram Bot Settings -->
                <div class="settings-section">
                    <h3>ü§ñ Telegram Bot Settings</h3>
                    <div class="bot-settings-grid">
                        <!-- Image Settings -->
                        <div class="bot-setting-card">
                            <h4>üñºÔ∏è Images</h4>
                            <div id="botImagesContainer">
                                <!-- Bot images will be loaded here -->
                            </div>
                            <button class="btn btn-success btn-sm" onclick="openBotSettingModal('image')">‚ûï Add Image</button>
                        </div>

                        <!-- Content Settings -->
                        <div class="bot-setting-card">
                            <h4>üìù Content</h4>
                            <div id="botContentContainer">
                                <!-- Bot content will be loaded here -->
                            </div>
                            <button class="btn btn-success btn-sm" onclick="openBotSettingModal('content')">‚ûï Add Content</button>
                        </div>

                        <!-- Buttons Settings -->
                        <div class="bot-setting-card">
                            <h4>üîò Buttons</h4>
                            <div id="botButtonsContainer">
                                <!-- Bot buttons will be loaded here -->
                            </div>
                            <button class="btn btn-success btn-sm" onclick="openBotSettingModal('button')">‚ûï Add Button</button>
                        </div>

                        <!-- Date Settings -->
                        <div class="bot-setting-card">
                            <h4>üìÖ Available Dates</h4>
                            <div id="botDatesContainer">
                                <!-- Bot dates will be loaded here -->
                            </div>
                            <button class="btn btn-success btn-sm" onclick="openBotSettingModal('date')">‚ûï Add Date</button>
                        </div>

                        <!-- Time Settings -->
                        <div class="bot-setting-card">
                            <h4>üïê Available Times</h4>
                            <div id="botTimesContainer">
                                <!-- Bot times will be loaded here -->
                            </div>
                            <button class="btn btn-success btn-sm" onclick="openBotSettingModal('time')">‚ûï Add Time</button>
                        </div>

                        <!-- Commands Settings -->
                        <div class="bot-setting-card">
                            <h4>‚å®Ô∏è Commands</h4>
                            <div id="botCommandsContainer">
                                <!-- Bot commands will be loaded here -->
                            </div>
                            <button class="btn btn-success btn-sm" onclick="openBotSettingModal('command')">‚ûï Add Command</button>
                        </div>
                    </div>

                    <!-- Bot Simulator -->
                    <div class="bot-simulator">
                        <h4>ü§ñ Bot Simulator</h4>
                        <div class="bot-screen" id="botScreen">
                            <div class="bot-message">
                                <p>Type /start to begin simulation</p>
                            </div>
                            <div style="text-align: center; margin-top: 20px;">
                                <button class="bot-btn" onclick="simulateStart()">/start</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notifications Settings -->
                <div class="settings-section">
                    <h3>üîî Notifications</h3>
                    <p>Automatically send notifications and reminders to users about their reservations</p>
                    <div style="display: flex; flex-direction: column; gap: 15px; margin-top: 15px;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <label>Enable automatic notifications:</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="autoNotifications" onchange="toggleAutoNotifications()">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-success" onclick="enableNotifications()">Enable automatic notifications</button>
                            <button class="btn btn-warning" onclick="disableNotifications()">Disable automatic notifications</button>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Reminder time before appointment (hours):</label>
                                <select id="reminderTime">
                                    <option value="1">1 hour</option>
                                    <option value="2" selected>2 hours</option>
                                    <option value="4">4 hours</option>
                                    <option value="24">24 hours</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Notification method:</label>
                                <select id="notificationMethod">
                                    <option value="telegram">Telegram</option>
                                    <option value="sms">SMS</option>
                                    <option value="both">Both</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Password Management -->
                <div class="settings-section">
                    <h3>üîê ‘≥’°’≤’ø’∂’°’¢’°’º’´ ’Ø’°’º’°’æ’°÷Ä’∏÷Ç’¥</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>‘∏’∂’©’°÷Å’´’Ø ’£’°’≤’ø’∂’°’¢’°’º:</label>
                            <input type="password" id="currentPassword">
                        </div>
                        <div class="form-group">
                            <label>’Ü’∏÷Ä ’£’°’≤’ø’∂’°’¢’°’º:</label>
                            <input type="password" id="newPassword">
                        </div>
                    </div>
                    <button class="btn btn-warning" onclick="changePassword()">’ì’∏’≠’•’¨ ’£’°’≤’ø’∂’°’¢’°’º’®</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Service Modal -->
    <div id="serviceModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeServiceModal()">&times;</span>
            <h2 id="serviceModalTitle">‘±’æ’•’¨’°÷Å’∂’•’¨ ’Æ’°’º’°’µ’∏÷Ç’©’µ’∏÷Ç’∂</h2>
            <form id="serviceForm">
                <div class="form-group">
                    <label>‘æ’°’º’°’µ’∏÷Ç’©’µ’°’∂ ’°’∂’æ’°’∂’∏÷Ç’¥:</label>
                    <input type="text" id="serviceName" required>
                </div>
                <div class="form-group">
                    <label>‘æ’°’º’°’µ’∏÷Ç’©’µ’°’∂ ’∂’Ø’°÷Ä’°’£÷Ä’∏÷Ç’©’µ’∏÷Ç’∂:</label>
                    <textarea id="serviceDescription" rows="3" placeholder="’Ü’Ø’°÷Ä’°’£÷Ä’•÷Ñ ’Æ’°’º’°’µ’∏÷Ç’©’µ’∏÷Ç’∂’®..."></textarea>
                </div>
                <div class="form-group">
                    <label>’è÷á’∏’≤’∏÷Ç’©’µ’∏÷Ç’∂ (÷Ä’∏’∫’•):</label>
                    <input type="number" id="serviceDuration" required min="1">
                </div>
                <div class="form-group">
                    <label>‘±÷Ä’™’•÷Ñ’® (÷è):</label>
                    <input type="number" id="servicePrice" required min="0" step="0.01">
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button type="submit" class="btn btn-success">’ä’°’∞’∫’°’∂’•’¨</button>
                    <button type="button" class="btn" onclick="closeServiceModal()">’â’•’≤’°÷Ä’Ø’•’¨</button>
                </div>
            </form>
        </div>
    </div>

    <!-- User Modal -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeUserModal()">&times;</span>
            <h2 id="userModalTitle">‘Ω’¥’¢’°’£÷Ä’•’¨ ÷Ö’£’ø’°’ø’•÷Ä’•÷Ä’´’∂</h2>
            <form id="userForm">
                <div class="form-group">
                    <label>‘±’∂’∏÷Ç’∂:</label>
                    <input type="text" id="userName" required>
                </div>
                <div class="form-group">
                    <label>’Ä’•’º’°’≠’∏’Ω:</label>
                    <input type="tel" id="userPhone" required>
                </div>
                <div class="form-group">
                    <label>Telegram ID:</label>
                    <input type="text" id="userTelegramId" required>
                </div>
                <div class="form-group">
                    <label>‘≤’∏’∂’∏÷Ç’Ω’∂’•÷Ä:</label>
                    <input type="number" id="userBonuses" min="0" step="0.01">
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button type="submit" class="btn btn-success">’ä’°’∞’∫’°’∂’•’¨</button>
                    <button type="button" class="btn" onclick="closeUserModal()">’â’•’≤’°÷Ä’Ø’•’¨</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Moderator Modal -->
    <div id="moderatorModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModeratorModal()">&times;</span>
            <h2 id="moderatorModalTitle">Add Moderator</h2>
            <form id="moderatorForm">
                <div class="form-group">
                    <label>Name:</label>
                    <input type="text" id="moderatorName" required>
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="moderatorEmail" required>
                </div>
                <div class="form-group">
                    <label>Username:</label>
                    <input type="text" id="moderatorUsername" required>
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="moderatorPassword" required>
                </div>
                <div class="form-group">
                    <label>Role:</label>
                    <select id="moderatorRole" required>
                        <option value="moderator">Moderator</option>
                        <option value="admin">Admin</option>
                        <option value="viewer">Viewer</option>
                    </select>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button type="submit" class="btn btn-success">Save</button>
                    <button type="button" class="btn" onclick="closeModeratorModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Email Modal -->
    <div id="emailModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEmailModal()">&times;</span>
            <h2 id="emailModalTitle">Send Email</h2>
            <form id="emailForm">
                <div class="form-group">
                    <label>To:</label>
                    <input type="email" id="emailTo" required readonly>
                </div>
                <div class="form-group">
                    <label>Subject:</label>
                    <input type="text" id="emailSubject" required>
                </div>
                <div class="form-group">
                    <label>Message:</label>
                    <textarea id="emailMessage" rows="6" required placeholder="Type your email message here..."></textarea>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button type="submit" class="btn btn-success">Send Email</button>
                    <button type="button" class="btn" onclick="closeEmailModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bot Setting Modal -->
    <div id="botSettingModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeBotSettingModal()">&times;</span>
            <h2 id="botSettingModalTitle">Add Setting</h2>
            <form id="botSettingForm">
                <div id="botSettingFields">
                    <!-- Dynamic fields will be added here -->
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button type="submit" class="btn btn-success">Save</button>
                    <button type="button" class="btn" onclick="closeBotSettingModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script>
        // Application State
        let currentEditingService = null;
        let currentEditingUser = null;
        let currentEditingModerator = null;
        let currentChatUser = null;
        let currentBotSetting = null;
        let currentBotSettingType = null;
        let adminPassword = null;
        let loginAttempts = 0;
        let isBlocked = false;
        let blockEndTime = null;
        let telegramBotConnected = false;
        let autoNotificationsEnabled = false;
        let botSimulationState = 'start';
        let currentBookingData = {};
        let inactivityTimer = null;
        let logoutWarningTimer = null;
        let isLoggedIn = false;
        let lastActivity = Date.now();

        // Auto-logout configuration (5 minutes = 300000ms)
        const INACTIVITY_TIMEOUT = 5 * 60 * 1000; // 5 minutes
        const WARNING_TIME = 30 * 1000; // 30 seconds warning

        // Security: SHA-256 Password Hashing
        function hashPassword(password) {
            return CryptoJS.SHA256(password).toString();
        }

        // Initialize default encrypted password
        const defaultPasswordHash = hashPassword('R00T$522166!Adm!n#ARIA*DEV');

        // Data Storage
        const storage = {
            get: (key) => {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : [];
                } catch (error) {
                    console.error('Error reading from localStorage:', error);
                    return [];
                }
            },
            set: (key, data) => {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                    return true;
                } catch (error) {
                    console.error('Error writing to localStorage:', error);
                    showNotification('’è’æ’µ’°’¨’∂’•÷Ä’´ ’∫’°’∞’∫’°’∂’¥’°’∂ ’Ω’≠’°’¨', 'error');
                    return false;
                }
            },
            remove: (key) => {
                try {
                    localStorage.removeItem(key);
                    return true;
                } catch (error) {
                    console.error('Error removing from localStorage:', error);
                    return false;
                }
            }
        };

        // Activity tracking for auto-logout
        function resetInactivityTimer() {
            lastActivity = Date.now();
            
            if (inactivityTimer) {
                clearTimeout(inactivityTimer);
            }
            if (logoutWarningTimer) {
                clearTimeout(logoutWarningTimer);
                hideLogoutWarning();
            }

            if (isLoggedIn) {
                // Set warning timer (4.5 minutes)
                logoutWarningTimer = setTimeout(() => {
                    showLogoutWarning();
                }, INACTIVITY_TIMEOUT - WARNING_TIME);

                // Set logout timer (5 minutes)
                inactivityTimer = setTimeout(() => {
                    autoLogout();
                }, INACTIVITY_TIMEOUT);
            }
        }

        function showLogoutWarning() {
            const warning = document.createElement('div');
            warning.className = 'logout-warning';
            warning.id = 'logoutWarning';
            warning.innerHTML = `
                <h4>‚ö†Ô∏è Session Timeout Warning</h4>
                <p>You will be logged out in 30 seconds due to inactivity.</p>
                <button class="btn btn-success" onclick="extendSession()">Stay Logged In</button>
            `;
            document.body.appendChild(warning);
        }

        function hideLogoutWarning() {
            const warning = document.getElementById('logoutWarning');
            if (warning) {
                warning.remove();
            }
        }

        function extendSession() {
            hideLogoutWarning();
            resetInactivityTimer();
            showNotification('Session extended', 'success');
        }

        function autoLogout() {
            hideLogoutWarning();
            logout();
            showNotification('Logged out due to inactivity', 'warning');
        }

        function logout() {
            isLoggedIn = false;
            if (inactivityTimer) clearTimeout(inactivityTimer);
            if (logoutWarningTimer) clearTimeout(logoutWarningTimer);
            
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('password').value = '';
            currentChatUser = null;
            
            // Clear session data but keep persistent data
            storage.remove('currentSession');
        }

        // Track user activity
        function trackActivity() {
            const events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click'];
            events.forEach(event => {
                document.addEventListener(event, resetInactivityTimer, true);
            });
        }

        // Session management
        function saveSession() {
            if (isLoggedIn) {
                storage.set('currentSession', [{
                    loginTime: Date.now(),
                    lastActivity: lastActivity
                }]);
            }
        }

        function checkExistingSession() {
            const session = storage.get('currentSession');
            if (session && session.length > 0) {
                const sessionData = session[0];
                const timeSinceLogin = Date.now() - sessionData.loginTime;
                const timeSinceActivity = Date.now() - sessionData.lastActivity;
                
                // If session is less than 5 minutes old and last activity was recent
                if (timeSinceLogin < INACTIVITY_TIMEOUT && timeSinceActivity < INACTIVITY_TIMEOUT) {
                    return true;
                }
            }
            return false;
        }

        // Confirmation Dialog Functions
        function showConfirmationDialog(message, onConfirm, onCancel = null) {
            const overlay = document.createElement('div');
            overlay.className = 'confirmation-overlay';
            
            const dialog = document.createElement('div');
            dialog.className = 'confirmation-dialog';
            dialog.innerHTML = `
                <h3>‚ö†Ô∏è Confirmation</h3>
                <p>${message}</p>
                <div class="confirmation-actions">
                    <button class="btn" onclick="closeConfirmationDialog(false)">Cancel</button>
                    <button class="btn btn-danger" onclick="closeConfirmationDialog(true)">Delete</button>
                </div>
            `;
            
            window.confirmationCallbacks = { onConfirm, onCancel };
            
            document.body.appendChild(overlay);
            document.body.appendChild(dialog);
        }

        function closeConfirmationDialog(confirmed) {
            const overlay = document.querySelector('.confirmation-overlay');
            const dialog = document.querySelector('.confirmation-dialog');
            
            if (overlay) overlay.remove();
            if (dialog) dialog.remove();
            
            if (window.confirmationCallbacks) {
                if (confirmed && window.confirmationCallbacks.onConfirm) {
                    window.confirmationCallbacks.onConfirm();
                } else if (!confirmed && window.confirmationCallbacks.onCancel) {
                    window.confirmationCallbacks.onCancel();
                }
                delete window.confirmationCallbacks;
            }
        }

        // Login attempt tracking and blocking
        function checkLoginBlock() {
            const blockData = storage.get('loginBlock');
            if (blockData && blockData.length > 0) {
                const block = blockData[0];
                if (new Date().getTime() < block.endTime) {
                    isBlocked = true;
                    blockEndTime = block.endTime;
                    showLoginBlock();
                    return true;
                }
            }
            return false;
        }

        function showLoginBlock() {
            const blockedDiv = document.getElementById('loginBlocked');
            const timeLeft = Math.ceil((blockEndTime - new Date().getTime()) / 1000 / 60);
            blockedDiv.innerHTML = `üö´ Account blocked for ${timeLeft} minutes due to multiple failed login attempts`;
            blockedDiv.style.display = 'block';
            document.getElementById('loginButton').disabled = true;
        }

        function blockLogin() {
            const blockTime = 3 * 60 * 60 * 1000; // 3 hours
            blockEndTime = new Date().getTime() + blockTime;
            storage.set('loginBlock', [{
                endTime: blockEndTime,
                attempts: loginAttempts,
                blockedAt: new Date().toISOString()
            }]);
            isBlocked = true;
            showLoginBlock();
        }

        function resetLoginAttempts() {
            loginAttempts = 0;
            storage.remove('loginBlock');
            document.getElementById('loginError').style.display = 'none';
            document.getElementById('loginBlocked').style.display = 'none';
            document.getElementById('loginButton').disabled = false;
        }

        // Notification System
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Initialize default data (removed demo users and reservations)
        function initializeData() {
            // Load saved password hash or use default
            const savedPasswordHash = storage.get('adminPasswordHash');
            if (savedPasswordHash && savedPasswordHash.length > 0) {
                adminPassword = savedPasswordHash[0];
            } else {
                adminPassword = defaultPasswordHash;
                storage.set('adminPasswordHash', [adminPassword]);
            }

            // Initialize services with default data only if empty
            if (!storage.get('services').length) {
                storage.set('services', [
                    { id: 1, name: '‘¥’°’Ω’°’Ø’°’∂ ’Ω’°’∂÷Ä’æ’°’Æ÷Ñ', description: '’Ñ’°’Ω’∂’°’£’´’ø’°’Ø’°’∂ ’Ω’°’∂÷Ä’æ’°’Æ÷Ñ ’¢’∏’¨’∏÷Ä ’ø’•’Ω’°’Ø’´ ’¥’°’¶’•÷Ä’´ ’∞’°’¥’°÷Ä', duration: 30, price: 25.00 },
                    { id: 2, name: '’Ñ’∏÷Ä’∏÷Ç÷Ñ’´ ’Ø’ø÷Ä’∏÷Ç’¥', description: '’Ñ’∏÷Ä’∏÷Ç÷Ñ’´ ’±÷á’°’æ’∏÷Ä’∏÷Ç’¥ ÷á ’Ø’ø÷Ä’∏÷Ç’¥', duration: 20, price: 15.00 },
                    { id: 3, name: '’Ñ’°’¶’•÷Ä’´ ’¨’æ’°÷Å’∏÷Ç’¥ ÷á ’∏’≥’°’æ’∏÷Ä’∏÷Ç’¥', description: '’Ñ’°’¶’•÷Ä’´ ’¨’æ’°÷Å’∏÷Ç’¥, ’Ω’°’∂÷Ä’æ’°’Æ÷Ñ ÷á ’∏’≥’°’æ’∏÷Ä’∏÷Ç’¥', duration: 45, price: 35.00 },
                    { id: 4, name: '‘±’¥’¢’∏’≤’ª’°’Ø’°’∂ ’Ω’∫’°’Ω’°÷Ä’Ø’∏÷Ç’¥', description: '’Ñ’°’¶’•÷Ä’´ ’Ø’ø÷Ä’∏÷Ç’¥, ’¥’∏÷Ä’∏÷Ç÷Ñ’´ ’±÷á’°’æ’∏÷Ä’∏÷Ç’¥ ÷á ’∏’≥’°’æ’∏÷Ä’∏÷Ç’¥', duration: 60, price: 50.00 }
                ]);
            }

            // Initialize empty arrays for users and reservations (no demo data)
            if (!storage.get('users').length) {
                storage.set('users', []);
            }

            if (!storage.get('reservations').length) {
                storage.set('reservations', []);
            }

            // Initialize moderators
            if (!storage.get('moderators').length) {
                storage.set('moderators', []);
            }

            // Initialize bot settings
            initializeBotSettings();

            // Initialize chat messages storage
            if (!storage.get('chatMessages').length) {
                storage.set('chatMessages', []);
            }

            // Initialize email history storage
            if (!storage.get('emailHistory').length) {
                storage.set('emailHistory', []);
            }

            // Load Telegram Bot configuration
            const telegramBot = storage.get('telegramBot');
            if (telegramBot && telegramBot.length > 0) {
                const bot = telegramBot[0];
                document.getElementById('telegramBotToken').value = bot.token || '';
                document.getElementById('telegramId').value = bot.telegramId || '';
                if (bot.connected) {
                    telegramBotConnected = true;
                    updateTelegramBotStatus(true);
                }
            }

            // Load notification settings
            const notificationSettings = storage.get('notificationSettings');
            if (notificationSettings && notificationSettings.length > 0) {
                const settings = notificationSettings[0];
                document.getElementById('autoNotifications').checked = settings.autoEnabled || false;
                document.getElementById('reminderTime').value = settings.reminderTime || '2';
                document.getElementById('notificationMethod').value = settings.method || 'telegram';
                autoNotificationsEnabled = settings.autoEnabled || false;
            }
        }

        // Initialize Bot Settings
        function initializeBotSettings() {
            if (!storage.get('botImages').length) {
                storage.set('botImages', [
                    { id: 1, name: 'Welcome Image', url: '/placeholder.svg?height=200&width=300', description: 'Welcome greeting image' }
                ]);
            }

            if (!storage.get('botContent').length) {
                storage.set('botContent', [
                    { id: 1, name: 'Welcome Message', content: 'Welcome to our Barbershop! üíà\n\nWe provide professional haircut and styling services. How can we help you today?' },
                    { id: 2, name: 'Start Message', content: 'Start the bot and display the welcome message' },
                    { id: 3, name: 'Help Message', content: 'Display help information' },
                    { id: 4, name: 'Services Message', content: 'Display available services' },
                    { id: 5, name: 'Book Message', content: 'Start the booking process' }
                ]);
            }

            if (!storage.get('botButtons').length) {
                storage.set('botButtons', [
                    { id: 1, name: 'Services', text: '‚úÇÔ∏è Services', action: 'show_services' },
                    { id: 2, name: 'Help', text: '‚ùì Help', action: 'show_help' },
                    { id: 3, name: 'Book', text: 'üìÖ Book', action: 'start_booking' },
                    { id: 4, name: 'Confirm', text: '‚úÖ Confirm', action: 'confirm_booking' }
                ]);
            }

            if (!storage.get('botDates').length) {
                const dates = [];
                for (let i = 1; i <= 7; i++) {
                    const date = new Date();
                    date.setDate(date.getDate() + i);
                    dates.push({
                        id: i,
                        date: date.toISOString().split('T')[0],
                        available: true
                    });
                }
                storage.set('botDates', dates);
            }

            if (!storage.get('botTimes').length) {
                storage.set('botTimes', [
                    { id: 1, time: '09:00', available: true },
                    { id: 2, time: '10:00', available: true },
                    { id: 3, time: '11:00', available: true },
                    { id: 4, time: '14:00', available: true },
                    { id: 5, time: '15:00', available: true },
                    { id: 6, time: '16:00', available: true },
                    { id: 7, time: '17:00', available: true }
                ]);
            }

            if (!storage.get('botCommands').length) {
                storage.set('botCommands', [
                    { id: 1, command: '/start', description: 'Start the bot and display the welcome message' },
                    { id: 2, command: '/help', description: 'Display help information' },
                    { id: 3, command: '/services', description: 'Display available services' },
                    { id: 4, command: '/book', description: 'Start the booking process' }
                ]);
            }
        }

        // Moderator Management Functions
        function loadModerators() {
            const moderators = storage.get('moderators');
            const container = document.getElementById('moderatorsContainer');
            
            if (moderators.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>No Moderators</h3>
                        <p>No moderators have been added yet.</p>
                    </div>
                `;
            } else {
                container.innerHTML = moderators.map(moderator => `
                    <div class="moderator-item">
                        <div class="moderator-info">
                            <strong>${moderator.name}</strong><br>
                            <small>${moderator.email} | @${moderator.username}</small>
                            <span class="moderator-role role-${moderator.role}">${moderator.role.toUpperCase()}</span>
                        </div>
                        <div class="setting-actions">
                            <button class="btn btn-warning btn-sm" onclick="editModerator(${moderator.id})">Edit</button>
                            <button class="btn btn-danger btn-sm" onclick="confirmDeleteModerator(${moderator.id})">Delete</button>
                        </div>
                    </div>
                `).join('');
            }
        }

        function openModeratorModal(moderatorId = null) {
            currentEditingModerator = moderatorId;
            const modal = document.getElementById('moderatorModal');
            const title = document.getElementById('moderatorModalTitle');
            
            if (moderatorId) {
                const moderator = storage.get('moderators').find(m => m.id === moderatorId);
                title.textContent = 'Edit Moderator';
                document.getElementById('moderatorName').value = moderator.name;
                document.getElementById('moderatorEmail').value = moderator.email;
                document.getElementById('moderatorUsername').value = moderator.username;
                document.getElementById('moderatorPassword').value = '';
                document.getElementById('moderatorRole').value = moderator.role;
            } else {
                title.textContent = 'Add Moderator';
                document.getElementById('moderatorForm').reset();
            }
            
            modal.style.display = 'block';
        }

        function closeModeratorModal() {
            document.getElementById('moderatorModal').style.display = 'none';
            currentEditingModerator = null;
        }

        function editModerator(id) {
            openModeratorModal(id);
        }

        function confirmDeleteModerator(id) {
            showConfirmationDialog(
                'Are you sure you want to delete?',
                () => deleteModerator(id)
            );
        }

        function deleteModerator(id) {
            let moderators = storage.get('moderators');
            moderators = moderators.filter(m => m.id !== id);
            storage.set('moderators', moderators);
            loadModerators();
            showNotification('Moderator deleted successfully', 'success');
        }

        // Moderator Form Handler
        document.getElementById('moderatorForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('moderatorName').value;
            const email = document.getElementById('moderatorEmail').value;
            const username = document.getElementById('moderatorUsername').value;
            const password = document.getElementById('moderatorPassword').value;
            const role = document.getElementById('moderatorRole').value;
            
            let moderators = storage.get('moderators');
            
            if (currentEditingModerator) {
                const index = moderators.findIndex(m => m.id === currentEditingModerator);
                const updatedModerator = { ...moderators[index], name, email, username, role };
                if (password) {
                    updatedModerator.password = hashPassword(password);
                }
                moderators[index] = updatedModerator;
                showNotification('Moderator updated successfully', 'success');
            } else {
                const newModerator = {
                    id: Date.now(),
                    name,
                    email,
                    username,
                    password: hashPassword(password),
                    role,
                    createdAt: new Date().toISOString()
                };
                moderators.push(newModerator);
                showNotification('Moderator added successfully', 'success');
            }
            
            storage.set('moderators', moderators);
            loadModerators();
            closeModeratorModal();
        });

        // Bot Settings Functions
        function loadBotSettings() {
            loadBotImages();
            loadBotContent();
            loadBotButtons();
            loadBotDates();
            loadBotTimes();
            loadBotCommands();
        }

        function loadBotImages() {
            const images = storage.get('botImages');
            const container = document.getElementById('botImagesContainer');
            
            container.innerHTML = images.map(image => `
                <div class="setting-item">
                    <div class="setting-content">
                        <strong>${image.name}</strong><br>
                        <small>${image.description}</small>
                    </div>
                    <div class="setting-actions">
                        <button class="btn btn-warning btn-sm" onclick="editBotSetting('image', ${image.id})">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="confirmDeleteBotSetting('image', ${image.id})">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function loadBotContent() {
            const content = storage.get('botContent');
            const container = document.getElementById('botContentContainer');
            
            container.innerHTML = content.map(item => `
                <div class="setting-item">
                    <div class="setting-content">
                        <strong>${item.name}</strong><br>
                        <small>${item.content.substring(0, 50)}...</small>
                    </div>
                    <div class="setting-actions">
                        <button class="btn btn-warning btn-sm" onclick="editBotSetting('content', ${item.id})">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="confirmDeleteBotSetting('content', ${item.id})">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function loadBotButtons() {
            const buttons = storage.get('botButtons');
            const container = document.getElementById('botButtonsContainer');
            
            container.innerHTML = buttons.map(button => `
                <div class="setting-item">
                    <div class="setting-content">
                        <strong>${button.name}</strong><br>
                        <small>${button.text} (${button.action})</small>
                    </div>
                    <div class="setting-actions">
                        <button class="btn btn-warning btn-sm" onclick="editBotSetting('button', ${button.id})">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="confirmDeleteBotSetting('button', ${button.id})">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function loadBotDates() {
            const dates = storage.get('botDates');
            const container = document.getElementById('botDatesContainer');
            
            container.innerHTML = dates.map(date => `
                <div class="setting-item">
                    <div class="setting-content">
                        <strong>${date.date}</strong><br>
                        <small>Available: ${date.available ? 'Yes' : 'No'}</small>
                    </div>
                    <div class="setting-actions">
                        <button class="btn btn-warning btn-sm" onclick="editBotSetting('date', ${date.id})">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="confirmDeleteBotSetting('date', ${date.id})">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function loadBotTimes() {
            const times = storage.get('botTimes');
            const container = document.getElementById('botTimesContainer');
            
            container.innerHTML = times.map(time => `
                <div class="setting-item">
                    <div class="setting-content">
                        <strong>${time.time}</strong><br>
                        <small>Available: ${time.available ? 'Yes' : 'No'}</small>
                    </div>
                    <div class="setting-actions">
                        <button class="btn btn-warning btn-sm" onclick="editBotSetting('time', ${time.id})">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="confirmDeleteBotSetting('time', ${time.id})">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function loadBotCommands() {
            const commands = storage.get('botCommands');
            const container = document.getElementById('botCommandsContainer');
            
            container.innerHTML = commands.map(command => `
                <div class="setting-item">
                    <div class="setting-content">
                        <strong>${command.command}</strong><br>
                        <small>${command.description}</small>
                    </div>
                    <div class="setting-actions">
                        <button class="btn btn-warning btn-sm" onclick="editBotSetting('command', ${command.id})">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="confirmDeleteBotSetting('command', ${command.id})">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function confirmDeleteBotSetting(type, id) {
            showConfirmationDialog(
                'Are you sure you want to delete?',
                () => deleteBotSetting(type, id)
            );
        }

        function openBotSettingModal(type, id = null) {
            currentBotSettingType = type;
            currentBotSetting = id;
            
            const modal = document.getElementById('botSettingModal');
            const title = document.getElementById('botSettingModalTitle');
            const fieldsContainer = document.getElementById('botSettingFields');
            
            title.textContent = id ? `Edit ${type.charAt(0).toUpperCase() + type.slice(1)}` : `Add ${type.charAt(0).toUpperCase() + type.slice(1)}`;
            
            let fieldsHtml = '';
            
            switch(type) {
                case 'image':
                    fieldsHtml = `
                        <div class="form-group">
                            <label>Name:</label>
                            <input type="text" id="botSettingName" required>
                        </div>
                        <div class="form-group">
                            <label>Image URL:</label>
                            <input type="url" id="botSettingUrl" required>
                        </div>
                        <div class="form-group">
                            <label>Description:</label>
                            <textarea id="botSettingDescription" rows="3"></textarea>
                        </div>
                    `;
                    break;
                case 'content':
                    fieldsHtml = `
                        <div class="form-group">
                            <label>Name:</label>
                            <input type="text" id="botSettingName" required>
                        </div>
                        <div class="form-group">
                            <label>Content:</label>
                            <textarea id="botSettingContent" rows="5" required></textarea>
                        </div>
                    `;
                    break;
                case 'button':
                    fieldsHtml = `
                        <div class="form-group">
                            <label>Name:</label>
                            <input type="text" id="botSettingName" required>
                        </div>
                        <div class="form-group">
                            <label>Button Text:</label>
                            <input type="text" id="botSettingText" required>
                        </div>
                        <div class="form-group">
                            <label>Action:</label>
                            <select id="botSettingAction" required>
                                <option value="show_services">Show Services</option>
                                <option value="show_help">Show Help</option>
                                <option value="start_booking">Start Booking</option>
                                <option value="confirm_booking">Confirm Booking</option>
                            </select>
                        </div>
                    `;
                    break;
                case 'date':
                    fieldsHtml = `
                        <div class="form-group">
                            <label>Date:</label>
                            <input type="date" id="botSettingDate" required>
                        </div>
                        <div class="form-group">
                            <label>Available:</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="botSettingAvailable" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    `;
                    break;
                case 'time':
                    fieldsHtml = `
                        <div class="form-group">
                            <label>Time:</label>
                            <input type="time" id="botSettingTime" required>
                        </div>
                        <div class="form-group">
                            <label>Available:</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="botSettingAvailable" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    `;
                    break;
                case 'command':
                    fieldsHtml = `
                        <div class="form-group">
                            <label>Command:</label>
                            <input type="text" id="botSettingCommand" required placeholder="/command">
                        </div>
                        <div class="form-group">
                            <label>Description:</label>
                            <textarea id="botSettingDescription" rows="3" required></textarea>
                        </div>
                    `;
                    break;
            }
            
            fieldsContainer.innerHTML = fieldsHtml;
            
            // Fill form if editing
            if (id) {
                fillBotSettingForm(type, id);
            }
            
            modal.style.display = 'block';
        }

        function fillBotSettingForm(type, id) {
            const data = storage.get(`bot${type.charAt(0).toUpperCase() + type.slice(1)}s`);
            const item = data.find(d => d.id === id);
            
            if (!item) return;
            
            switch(type) {
                case 'image':
                    document.getElementById('botSettingName').value = item.name;
                    document.getElementById('botSettingUrl').value = item.url;
                    document.getElementById('botSettingDescription').value = item.description || '';
                    break;
                case 'content':
                    document.getElementById('botSettingName').value = item.name;
                    document.getElementById('botSettingContent').value = item.content;
                    break;
                case 'button':
                    document.getElementById('botSettingName').value = item.name;
                    document.getElementById('botSettingText').value = item.text;
                    document.getElementById('botSettingAction').value = item.action;
                    break;
                case 'date':
                    document.getElementById('botSettingDate').value = item.date;
                    document.getElementById('botSettingAvailable').checked = item.available;
                    break;
                case 'time':
                    document.getElementById('botSettingTime').value = item.time;
                    document.getElementById('botSettingAvailable').checked = item.available;
                    break;
                case 'command':
                    document.getElementById('botSettingCommand').value = item.command;
                    document.getElementById('botSettingDescription').value = item.description;
                    break;
            }
        }

        function closeBotSettingModal() {
            document.getElementById('botSettingModal').style.display = 'none';
            currentBotSetting = null;
            currentBotSettingType = null;
        }

        function editBotSetting(type, id) {
            openBotSettingModal(type, id);
        }

        function deleteBotSetting(type, id) {
            const storageKey = `bot${type.charAt(0).toUpperCase() + type.slice(1)}s`;
            let data = storage.get(storageKey);
            data = data.filter(item => item.id !== id);
            storage.set(storageKey, data);
            loadBotSettings();
            showNotification(`${type.charAt(0).toUpperCase() + type.slice(1)} deleted successfully`, 'success');
        }

        // Bot Setting Form Handler
        document.getElementById('botSettingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const type = currentBotSettingType;
            const storageKey = `bot${type.charAt(0).toUpperCase() + type.slice(1)}s`;
            let data = storage.get(storageKey);
            
            let newItem = {};
            
            switch(type) {
                case 'image':
                    newItem = {
                        id: currentBotSetting || Date.now(),
                        name: document.getElementById('botSettingName').value,
                        url: document.getElementById('botSettingUrl').value,
                        description: document.getElementById('botSettingDescription').value
                    };
                    break;
                case 'content':
                    newItem = {
                        id: currentBotSetting || Date.now(),
                        name: document.getElementById('botSettingName').value,
                        content: document.getElementById('botSettingContent').value
                    };
                    break;
                case 'button':
                    newItem = {
                        id: currentBotSetting || Date.now(),
                        name: document.getElementById('botSettingName').value,
                        text: document.getElementById('botSettingText').value,
                        action: document.getElementById('botSettingAction').value
                    };
                    break;
                case 'date':
                    newItem = {
                        id: currentBotSetting || Date.now(),
                        date: document.getElementById('botSettingDate').value,
                        available: document.getElementById('botSettingAvailable').checked
                    };
                    break;
                case 'time':
                    newItem = {
                        id: currentBotSetting || Date.now(),
                        time: document.getElementById('botSettingTime').value,
                        available: document.getElementById('botSettingAvailable').checked
                    };
                    break;
                case 'command':
                    newItem = {
                        id: currentBotSetting || Date.now(),
                        command: document.getElementById('botSettingCommand').value,
                        description: document.getElementById('botSettingDescription').value
                    };
                    break;
            }
            
            if (currentBotSetting) {
                const index = data.findIndex(item => item.id === currentBotSetting);
                data[index] = newItem;
                showNotification(`${type.charAt(0).toUpperCase() + type.slice(1)} updated successfully`, 'success');
            } else {
                data.push(newItem);
                showNotification(`${type.charAt(0).toUpperCase() + type.slice(1)} added successfully`, 'success');
            }
            
            storage.set(storageKey, data);
            loadBotSettings();
            closeBotSettingModal();
        });

        // Bot Simulation Functions
        function simulateStart() {
            botSimulationState = 'start';
            const screen = document.getElementById('botScreen');
            const images = storage.get('botImages');
            const content = storage.get('botContent');
            const buttons = storage.get('botButtons');
            
            const welcomeImage = images.find(img => img.name === 'Welcome Image');
            const welcomeContent = content.find(c => c.name === 'Welcome Message');
            const servicesBtn = buttons.find(btn => btn.action === 'show_services');
            const helpBtn = buttons.find(btn => btn.action === 'show_help');
            
            screen.innerHTML = `
                ${welcomeImage ? `<img src="${welcomeImage.url}" alt="${welcomeImage.name}" class="bot-image">` : ''}
                <div class="bot-message">
                    <p>${welcomeContent ? welcomeContent.content : 'Welcome to our Barbershop! üíà'}</p>
                </div>
                <div class="bot-buttons">
                    ${servicesBtn ? `<button class="bot-btn" onclick="simulateServices()">${servicesBtn.text}</button>` : ''}
                    ${helpBtn ? `<button class="bot-btn" onclick="simulateHelp()">${helpBtn.text}</button>` : ''}
                </div>
            `;
        }

        function simulateServices() {
            botSimulationState = 'services';
            const screen = document.getElementById('botScreen');
            const services = storage.get('services');
            const buttons = storage.get('botButtons');
            const bookBtn = buttons.find(btn => btn.action === 'start_booking');
            
            let servicesHtml = '<div class="bot-message"><p><strong>Our Services:</strong></p>';
            services.forEach((service, index) => {
                servicesHtml += `<p>${index + 1}. ${service.name} - ÷è${service.price} (${service.duration} min)</p>`;
            });
            servicesHtml += '</div>';
            
            screen.innerHTML = `
                ${servicesHtml}
                <div class="bot-buttons">
                    ${bookBtn ? `<button class="bot-btn" onclick="simulateBooking()">${bookBtn.text}</button>` : ''}
                    <button class="bot-btn" onclick="simulateStart()">üîô Back</button>
                </div>
            `;
        }

        function simulateHelp() {
            const screen = document.getElementById('botScreen');
            
            screen.innerHTML = `
                <div class="bot-message">
                    <p><strong>Help & Information:</strong></p>
                    <p>üìç Address: Yerevan, Armenia</p>
                    <p>üìû Phone: +374 88 123 456</p>
                    <p>üïê Working Hours: 9:00 - 18:00</p>
                    <p>üí¨ You can book appointments through this bot</p>
                </div>
                <div class="bot-buttons">
                    <button class="bot-btn" onclick="simulateStart()">üîô Back</button>
                </div>
            `;
        }

        function simulateBooking() {
            botSimulationState = 'booking';
            const screen = document.getElementById('botScreen');
            
            screen.innerHTML = `
                <div class="bot-message">
                    <p><strong>Booking Information:</strong></p>
                    <p>Please provide your details:</p>
                    <p><strong>Name:</strong> <input type="text" id="bookingName" placeholder="Your name" style="margin: 5px; padding: 5px; border: 1px solid #ddd; border-radius: 4px;"></p>
                    <p><strong>Phone:</strong> <input type="tel" id="bookingPhone" placeholder="Your phone" style="margin: 5px; padding: 5px; border: 1px solid #ddd; border-radius: 4px;"></p>
                </div>
                <div class="bot-buttons">
                    <button class="bot-btn" onclick="simulateDateTime()">Next ‚û°Ô∏è</button>
                    <button class="bot-btn" onclick="simulateServices()">üîô Back</button>
                </div>
            `;
        }

        function simulateDateTime() {
            const name = document.getElementById('bookingName').value;
            const phone = document.getElementById('bookingPhone').value;
            
            if (!name || !phone) {
                showNotification('Please fill in all fields', 'warning');
                return;
            }
            
            currentBookingData = { name, phone };
            
            const screen = document.getElementById('botScreen');
            const dates = storage.get('botDates').filter(d => d.available);
            const times = storage.get('botTimes').filter(t => t.available);
            const buttons = storage.get('botButtons');
            const confirmBtn = buttons.find(btn => btn.action === 'confirm_booking');
            
            let datesHtml = '<p><strong>Available Dates:</strong></p>';
            dates.forEach(date => {
                datesHtml += `<button class="bot-btn" onclick="selectDate('${date.date}')" style="margin: 2px; font-size: 12px;">${date.date}</button>`;
            });
            
            let timesHtml = '<p><strong>Available Times:</strong></p>';
            times.forEach(time => {
                timesHtml += `<button class="bot-btn" onclick="selectTime('${time.time}')" style="margin: 2px; font-size: 12px;">${time.time}</button>`;
            });
            
            screen.innerHTML = `
                <div class="bot-message">
                    <p><strong>Select Date & Time:</strong></p>
                    ${datesHtml}
                    ${timesHtml}
                    <div id="selectedDateTime" style="margin-top: 10px; font-weight: bold;"></div>
                </div>
                <div class="bot-buttons">
                    ${confirmBtn ? `<button class="bot-btn" id="confirmBookingBtn" onclick="simulateConfirm()" style="display: none;">${confirmBtn.text}</button>` : ''}
                    <button class="bot-btn" onclick="simulateBooking()">üîô Back</button>
                </div>
            `;
        }

        function selectDate(date) {
            currentBookingData.date = date;
            updateSelectedDateTime();
        }

        function selectTime(time) {
            currentBookingData.time = time;
            updateSelectedDateTime();
        }

        function updateSelectedDateTime() {
            const selectedDiv = document.getElementById('selectedDateTime');
            if (currentBookingData.date && currentBookingData.time) {
                selectedDiv.innerHTML = `Selected: ${currentBookingData.date} at ${currentBookingData.time}`;
                document.getElementById('confirmBookingBtn').style.display = 'inline-block';
            }
        }

        function simulateConfirm() {
            if (!currentBookingData.date || !currentBookingData.time) {
                showNotification('Please select date and time', 'warning');
                return;
            }
            
            // Create reservation
            const services = storage.get('services');
            const randomService = services[Math.floor(Math.random() * services.length)];
            
            const reservation = {
                id: Date.now(),
                userName: currentBookingData.name,
                phone: currentBookingData.phone,
                serviceName: randomService.name,
                serviceId: randomService.id,
                date: currentBookingData.date,
                time: currentBookingData.time,
                status: 'Pending',
                notes: 'Booked via Telegram Bot',
                timestamp: new Date().toISOString()
            };
            
            // Show reservation popup
            showReservationPopup(reservation);
            
            // Update bot screen
            const screen = document.getElementById('botScreen');
            screen.innerHTML = `
                <div class="bot-message">
                    <p><strong>Booking Submitted! ‚úÖ</strong></p>
                    <p>Your booking request has been sent to the admin.</p>
                    <p>You will receive a confirmation shortly.</p>
                    <p><strong>Details:</strong></p>
                    <p>Name: ${currentBookingData.name}</p>
                    <p>Phone: ${currentBookingData.phone}</p>
                    <p>Date: ${currentBookingData.date}</p>
                    <p>Time: ${currentBookingData.time}</p>
                </div>
                <div class="bot-buttons">
                    <button class="bot-btn" onclick="simulateStart()">üè† Home</button>
                </div>
            `;
            
            currentBookingData = {};
        }

        function showReservationPopup(reservation) {
            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'popup-overlay';
            
            // Create popup
            const popup = document.createElement('div');
            popup.className = 'reservation-popup';
            popup.innerHTML = `
                <h3>üîî New Reservation Request</h3>
                <div class="reservation-details">
                    <p><strong>Name:</strong> ${reservation.userName}</p>
                    <p><strong>Phone:</strong> ${reservation.phone}</p>
                    <p><strong>Service:</strong> ${reservation.serviceName}</p>
                    <p><strong>Date:</strong> ${reservation.date}</p>
                    <p><strong>Time:</strong> ${reservation.time}</p>
                    <p><strong>Notes:</strong> ${reservation.notes}</p>
                </div>
                <div class="popup-actions">
                    <button class="btn btn-success" onclick="confirmReservation(${reservation.id})">‚úÖ Confirm</button>
                    <button class="btn btn-danger" onclick="declineReservation(${reservation.id})">‚ùå Decline</button>
                </div>
            `;
            
            // Store reservation temporarily
            window.tempReservation = reservation;
            
            document.body.appendChild(overlay);
            document.body.appendChild(popup);
            
            // Auto-remove after 30 seconds if no action
            setTimeout(() => {
                if (document.body.contains(popup)) {
                    declineReservation(reservation.id);
                }
            }, 30000);
        }

        function confirmReservation(id) {
            const reservation = window.tempReservation;
            if (reservation) {
                reservation.status = '‘∏’∂’§’∏÷Ç’∂’æ’°’Æ';
                
                // Add to reservations
                let reservations = storage.get('reservations');
                reservations.push(reservation);
                storage.set('reservations', reservations);
                
                // Remove popup
                removeReservationPopup();
                
                showNotification('Reservation confirmed successfully', 'success');
                loadDashboard();
                
                // Update reservations page if active
                if (document.getElementById('reservations').classList.contains('active')) {
                    loadReservations();
                }
            }
        }

        function declineReservation(id) {
            removeReservationPopup();
            showNotification('Reservation declined', 'warning');
        }

        function removeReservationPopup() {
            const overlay = document.querySelector('.popup-overlay');
            const popup = document.querySelector('.reservation-popup');
            
            if (overlay) overlay.remove();
            if (popup) popup.remove();
            
            delete window.tempReservation;
        }

        // Telegram Bot Functions
        function connectTelegramBot() {
            const token = document.getElementById('telegramBotToken').value;
            const telegramId = document.getElementById('telegramId').value;

            if (!token || !telegramId) {
                showNotification('Please enter both Bot Token and Telegram ID', 'error');
                return;
            }

            setTimeout(() => {
                telegramBotConnected = true;
                updateTelegramBotStatus(true);
                
                storage.set('telegramBot', [{
                    token: token,
                    telegramId: telegramId,
                    connected: true,
                    connectedAt: new Date().toISOString()
                }]);

                showNotification('Telegram Bot connected successfully', 'success');
                
                // Send welcome message to simulate bot activation
                simulateTelegramMessage('ü§ñ Telegram Bot has been successfully integrated into the management system');
            }, 1000);
        }

        function testTelegramBot() {
            if (!telegramBotConnected) {
                showNotification('Please connect the bot first', 'warning');
                return;
            }

            // Send test message
            simulateTelegramMessage('Telegram Bot has been successfully integrated into the management system');
            showNotification('Test message sent to Telegram bot', 'success');
        }

        function deleteTelegramBot() {
            showConfirmationDialog(
                'Are you sure you want to delete?',
                () => {
                    // Send deletion message before disconnecting
                    if (telegramBotConnected) {
                        simulateTelegramMessage('Telegram Bot has been successfully removed from the management system');
                    }
                    
                    telegramBotConnected = false;
                    updateTelegramBotStatus(false);
                    document.getElementById('telegramBotToken').value = '';
                    document.getElementById('telegramId').value = '';
                    storage.remove('telegramBot');
                    showNotification('Telegram Bot deleted successfully', 'success');
                }
            );
        }

        function simulateTelegramMessage(message) {
            // Create a temporary notification to simulate Telegram message
            const telegramNotification = document.createElement('div');
            telegramNotification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: #0088cc;
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
                z-index: 3000;
                max-width: 300px;
                font-size: 14px;
                border-left: 4px solid #ffffff;
            `;
            telegramNotification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 18px;">üì±</span>
                    <div>
                        <strong>Telegram Bot</strong><br>
                        ${message}
                    </div>
                </div>
            `;
            
            document.body.appendChild(telegramNotification);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (document.body.contains(telegramNotification)) {
                    telegramNotification.remove();
                }
            }, 5000);
        }

        function handleTelegramCommand(command) {
            if (!telegramBotConnected) return;
            
            const content = storage.get('botContent');
            let message = '';
            
            switch(command) {
                case '/start':
                    const startMessage = content.find(c => c.name === 'Start Message');
                    message = startMessage ? startMessage.content : 'Start the bot and display the welcome message';
                    break;
                case '/help':
                    const helpMessage = content.find(c => c.name === 'Help Message');
                    message = helpMessage ? helpMessage.content : 'Display help information';
                    break;
                case '/services':
                    const servicesMessage = content.find(c => c.name === 'Services Message');
                    message = servicesMessage ? servicesMessage.content : 'Display available services';
                    break;
                case '/book':
                    const bookMessage = content.find(c => c.name === 'Book Message');
                    message = bookMessage ? bookMessage.content : 'Start the booking process';
                    break;
                default:
                    message = 'Unknown command';
            }
            
            simulateTelegramMessage(message);
        }

        function updateTelegramBotStatus(connected) {
            const card = document.getElementById('telegramBotCard');
            const indicator = document.getElementById('botStatusIndicator');
            const statusText = document.getElementById('botStatusText');

            if (connected) {
                card.className = 'telegram-bot-card connected';
                indicator.className = 'status-indicator active';
                statusText.textContent = 'Status: Active';
            } else {
                card.className = 'telegram-bot-card disconnected';
                indicator.className = 'status-indicator inactive';
                statusText.textContent = 'Status: Passive';
            }
        }

        // Notification Functions
        function toggleAutoNotifications() {
            autoNotificationsEnabled = document.getElementById('autoNotifications').checked;
            storage.set('notificationSettings', [{
                autoEnabled: autoNotificationsEnabled,
                reminderTime: document.getElementById('reminderTime').value,
                method: document.getElementById('notificationMethod').value
            }]);
            
            const status = autoNotificationsEnabled ? 'enabled' : 'disabled';
            showNotification(`Automatic notifications ${status}`, 'success');
        }

        function enableNotifications() {
            document.getElementById('autoNotifications').checked = true;
            toggleAutoNotifications();
        }

        function disableNotifications() {
            document.getElementById('autoNotifications').checked = false;
            toggleAutoNotifications();
        }

        // Chat Functions
        function loadChatUsers() {
            const users = storage.get('users');
            const container = document.getElementById('chatUsersList');
            
            if (users.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999;">No users available</p>';
                return;
            }

            container.innerHTML = users.map(user => `
                <div class="user-item" onclick="selectChatUser(${user.id})">
                    <h5>${user.name}</h5>
                    <p>${user.phone}</p>
                    <p>${user.email || 'No email'}</p>
                </div>
            `).join('');
        }

        function selectChatUser(userId) {
            const users = storage.get('users');
            const user = users.find(u => u.id === userId);
            
            if (!user) return;

            currentChatUser = user;
            
            // Update active user
            document.querySelectorAll('.user-item').forEach(item => item.classList.remove('active'));
            event.target.closest('.user-item').classList.add('active');
            
            // Update chat header
            document.getElementById('chatUserName').textContent = `Chat with ${user.name}`;
            
            // Show chat input
            document.getElementById('chatInputArea').style.display = 'block';
            
            // Load chat messages
            loadChatMessages(userId);
            
            // Hide placeholder
            const placeholder = document.querySelector('.chat-placeholder');
            if (placeholder) {
                placeholder.style.display = 'none';
            }
        }

        function loadChatMessages(userId) {
            const messages = storage.get('chatMessages').filter(msg => 
                msg.userId === userId
            );
            
            const container = document.getElementById('chatMessages');
            
            if (messages.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">No messages yet. Start the conversation!</p>';
                return;
            }

            container.innerHTML = messages.map(message => `
                <div class="message ${message.type}">
                    <div>${message.content}</div>
                    <div class="message-time">${new Date(message.timestamp).toLocaleString()}</div>
                </div>
            `).join('');
            
            // Scroll to bottom
            container.scrollTop = container.scrollHeight;
        }

        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const content = messageInput.value.trim();
            
            if (!content || !currentChatUser) {
                showNotification('Please enter a message', 'warning');
                return;
            }

            const message = {
                id: Date.now(),
                userId: currentChatUser.id,
                content: content,
                type: 'sent',
                timestamp: new Date().toISOString()
            };

            // Save message
            let messages = storage.get('chatMessages');
            messages.push(message);
            storage.set('chatMessages', messages);

            // Clear input
            messageInput.value = '';

            // Reload messages
            loadChatMessages(currentChatUser.id);

            showNotification('Message sent successfully', 'success');

            // Simulate user reply after 2 seconds
            setTimeout(() => {
                const replyMessage = {
                    id: Date.now(),
                    userId: currentChatUser.id,
                    content: 'Thank you for your message! I will get back to you soon.',
                    type: 'received',
                    timestamp: new Date().toISOString()
                };

                let messages = storage.get('chatMessages');
                messages.push(replyMessage);
                storage.set('chatMessages', messages);

                loadChatMessages(currentChatUser.id);
            }, 2000);
        }

        function sendEmail() {
            if (!currentChatUser) {
                showNotification('Please select a user first', 'warning');
                return;
            }

            document.getElementById('emailTo').value = currentChatUser.email || `${currentChatUser.name.toLowerCase().replace(' ', '.')}@example.com`;
            document.getElementById('emailSubject').value = '';
            document.getElementById('emailMessage').value = '';
            document.getElementById('emailModalTitle').textContent = 'Send Email';
            document.getElementById('emailModal').style.display = 'block';
        }

        function replyToEmail() {
            if (!currentChatUser) {
                showNotification('Please select a user first', 'warning');
                return;
            }

            document.getElementById('emailTo').value = currentChatUser.email || `${currentChatUser.name.toLowerCase().replace(' ', '.')}@example.com`;
            document.getElementById('emailSubject').value = 'Re: Your inquiry';
            document.getElementById('emailMessage').value = '';
            document.getElementById('emailModalTitle').textContent = 'Reply to Email';
            document.getElementById('emailModal').style.display = 'block';
        }

        function viewEmailHistory() {
            if (!currentChatUser) {
                showNotification('Please select a user first', 'warning');
                return;
            }

            const emailHistory = storage.get('emailHistory').filter(email => 
                email.userId === currentChatUser.id
            );

            if (emailHistory.length === 0) {
                showNotification('No email history found for this user', 'warning');
                return;
            }

            let historyHtml = `<h3>Email History for ${currentChatUser.name}</h3>`;
            historyHtml += emailHistory.map(email => `
                <div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 5px;">
                    <strong>Subject:</strong> ${email.subject}<br>
                    <strong>Date:</strong> ${new Date(email.timestamp).toLocaleString()}<br>
                    <strong>Message:</strong> ${email.message}
                </div>
            `).join('');

            // Create a temporary modal for email history
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                    ${historyHtml}
                </div>
            `;
            document.body.appendChild(modal);
        }

        function closeEmailModal() {
            document.getElementById('emailModal').style.display = 'none';
        }

        // Email Form Handler
        document.getElementById('emailForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const to = document.getElementById('emailTo').value;
            const subject = document.getElementById('emailSubject').value;
            const message = document.getElementById('emailMessage').value;
            
            const email = {
                id: Date.now(),
                userId: currentChatUser.id,
                to: to,
                subject: subject,
                message: message,
                timestamp: new Date().toISOString()
            };

            // Save email to history
            let emailHistory = storage.get('emailHistory');
            emailHistory.push(email);
            storage.set('emailHistory', emailHistory);

            closeEmailModal();
            showNotification('Email sent successfully', 'success');
        });

        // Authentication
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (checkLoginBlock()) {
                return;
            }
            
            const password = document.getElementById('password').value;
            const hashedPassword = hashPassword(password);
            
            if (hashedPassword === adminPassword) {
                resetLoginAttempts();
                isLoggedIn = true;
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                initializeData();
                loadDashboard();
                saveSession();
                resetInactivityTimer();
                showNotification('’Ñ’∏÷Ç’ø÷Ñ’® ’∞’°’ª’∏’≤’æ’°’Æ ’ß', 'success');
            } else {
                loginAttempts++;
                const errorDiv = document.getElementById('loginError');
                errorDiv.innerHTML = `‚ùå Invalid password. Attempt ${loginAttempts}/3`;
                errorDiv.style.display = 'block';
                
                if (loginAttempts >= 3) {
                    blockLogin();
                }
                
                showNotification('‘±’∂’æ’°’æ’•÷Ä ’£’°’≤’ø’∂’°’¢’°’º', 'error');
            }
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', function() {
            logout();
            showNotification('’Ä’°’ª’∏’≤’∏÷Ç’©’µ’°’¥’¢ ’§’∏÷Ç÷Ä’Ω ’•÷Ñ ’•’Ø’•’¨:', 'success');
        });

        // Mobile Navigation
        document.getElementById('mobileToggle').addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('mobile-show');
        });

        // Page Navigation
        document.querySelectorAll('.sidebar-menu a').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const page = this.dataset.page;
                showPage(page);
                
                document.querySelectorAll('.sidebar-menu a').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                
                document.getElementById('sidebar').classList.remove('mobile-show');
            });
        });

        // Show Page
        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(page).classList.add('active');
            
            const titles = {
                dashboard: '’é’°’∞’°’∂’°’Ø',
                services: '‘æ’°’º’°’µ’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä',
                users: '’ï’£’ø’°’ø’•÷Ä’•÷Ä',
                reservations: '‘±’¥÷Ä’°’£÷Ä’∏÷Ç’¥’∂’•÷Ä',
                chat: 'Chat',
                settings: '‘ø’°÷Ä’£’°’æ’∏÷Ä’∏÷Ç’¥’∂’•÷Ä'
            };
            
            document.getElementById('pageTitle').textContent = titles[page];
            
            switch(page) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'services':
                    loadServices();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'reservations':
                    loadReservations();
                    break;
                case 'chat':
                    loadChatUsers();
                    break;
                case 'settings':
                    loadBotSettings();
                    loadModerators();
                    break;
            }
        }

        // Dashboard Functions
        function loadDashboard() {
            const users = storage.get('users');
            const reservations = storage.get('reservations');
            const services = storage.get('services');
            
            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('totalReservations').textContent = reservations.length;
            document.getElementById('totalServices').textContent = services.length;
        }

        function filterStats(type, period) {
            let filteredCount = 0;
            
            if (type === 'users') {
                const users = storage.get('users');
                switch(period) {
                    case 'daily':
                        filteredCount = Math.max(0, Math.floor(users.length * 0.1));
                        break;
                    case 'weekly':
                        filteredCount = Math.max(0, Math.floor(users.length * 0.3));
                        break;
                    case 'monthly':
                        filteredCount = users.length;
                        break;
                }
                document.getElementById('totalUsers').textContent = filteredCount;
            } else if (type === 'reservations') {
                const reservations = storage.get('reservations');
                switch(period) {
                    case 'daily':
                        filteredCount = Math.max(0, Math.floor(reservations.length * 0.2));
                        break;
                    case 'weekly':
                        filteredCount = Math.max(0, Math.floor(reservations.length * 0.6));
                        break;
                    case 'monthly':
                        filteredCount = reservations.length;
                        break;
                }
                document.getElementById('totalReservations').textContent = filteredCount;
            }
            
            showNotification(`’ë’∏÷Ç÷Å’°’§÷Ä’æ’∏÷Ç’¥ ’ß ${period} ’æ’´’≥’°’Ø’°’£÷Ä’∏÷Ç’©’µ’∏÷Ç’∂`, 'success');
        }

        // Services Functions
        function loadServices() {
            const services = storage.get('services');
            const container = document.getElementById('servicesContainer');
            
            if (services.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>No Services</h3>
                        <p>‘æ’°’º’°’µ’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä ’π’•’∂ ’°’æ’•’¨’°÷Å’æ’•’¨:</p>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>‘±’∂’æ’°’∂’∏÷Ç’¥</th>
                                <th>’Ü’Ø’°÷Ä’°’£÷Ä’∏÷Ç’©’µ’∏÷Ç’∂</th>
                                <th>’è÷á’∏’≤’∏÷Ç’©’µ’∏÷Ç’∂ (÷Ä’∏’∫’•)</th>
                                <th>‘±÷Ä’™’•÷Ñ (÷è)</th>
                                <th>‘≥’∏÷Ä’Æ’∏’≤’∏÷Ç’©’µ’∏÷Ç’∂</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${services.map(service => `
                                <tr>
                                    <td>${service.name}</td>
                                    <td>${service.description || '’Ü’Ø’°÷Ä’°’£÷Ä’∏÷Ç’©’µ’∏÷Ç’∂ ’π’Ø’°'}</td>
                                    <td>${service.duration}</td>
                                    <td>÷è ${service.price.toFixed(2)}</td>
                                    <td>
                                        <button class="btn btn-warning" onclick="editService(${service.id})">‘Ω’¥’¢’°’£÷Ä’•’¨</button>
                                        <button class="btn btn-danger" onclick="confirmDeleteService(${service.id})">’ã’∂’ª’•’¨</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            }
        }

        function openServiceModal(serviceId = null) {
            currentEditingService = serviceId;
            const modal = document.getElementById('serviceModal');
            const title = document.getElementById('serviceModalTitle');
            
            if (serviceId) {
                const service = storage.get('services').find(s => s.id === serviceId);
                title.textContent = '‘Ω’¥’¢’°’£÷Ä’•’¨ ’Æ’°’º’°’µ’∏÷Ç’©’µ’∏÷Ç’∂’®';
                document.getElementById('serviceName').value = service.name;
                document.getElementById('serviceDescription').value = service.description || '';
                document.getElementById('serviceDuration').value = service.duration;
                document.getElementById('servicePrice').value = service.price;
            } else {
                title.textContent = '‘±’æ’•’¨’°÷Å’∂’•’¨ ’Æ’°’º’°’µ’∏÷Ç’©’µ’∏÷Ç’∂';
                document.getElementById('serviceForm').reset();
            }
            
            modal.style.display = 'block';
        }

        function closeServiceModal() {
            document.getElementById('serviceModal').style.display = 'none';
            currentEditingService = null;
        }

        function editService(id) {
            openServiceModal(id);
        }

        function confirmDeleteService(id) {
            showConfirmationDialog(
                'Are you sure you want to delete?',
                () => deleteService(id)
            );
        }

        function deleteService(id) {
            let services = storage.get('services');
            services = services.filter(s => s.id !== id);
            storage.set('services', services);
            loadServices();
            loadDashboard();
            showNotification('‘æ’°’º’°’µ’∏÷Ç’©’µ’∏÷Ç’∂’® ’∞’°’ª’∏’≤’∏÷Ç’©’µ’°’¥’¢ ’ª’∂’ª’æ’•÷Å', 'success');
        }

        // Service Form Handler
        document.getElementById('serviceForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('serviceName').value;
            const description = document.getElementById('serviceDescription').value;
            const duration = parseInt(document.getElementById('serviceDuration').value);
            const price = parseFloat(document.getElementById('servicePrice').value);
            
            let services = storage.get('services');
            
            if (currentEditingService) {
                const index = services.findIndex(s => s.id === currentEditingService);
                services[index] = { ...services[index], name, description, duration, price };
                showNotification('‘æ’°’º’°’µ’∏÷Ç’©’µ’∏÷Ç’∂’® ’∞’°’ª’∏’≤’∏÷Ç’©’µ’°’¥’¢ ’©’°÷Ä’¥’°÷Å’æ’•÷Å', 'success');
            } else {
                const newService = {
                    id: Date.now(),
                    name,
                    description,
                    duration,
                    price
                };
                services.push(newService);
                showNotification('‘æ’°’º’°’µ’∏÷Ç’©’µ’∏÷Ç’∂’® ’∞’°’ª’∏’≤’∏÷Ç’©’µ’°’¥’¢ ’°’æ’•’¨’°÷Å’æ’•÷Å', 'success');
            }
            
            storage.set('services', services);
            loadServices();
            loadDashboard();
            closeServiceModal();
        });

        // Users Functions
        function loadUsers() {
            const users = storage.get('users');
            const container = document.getElementById('usersContainer');
            
            if (users.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>No Users</h3>
                        <p>’ï’£’ø’°’ø’•÷Ä’•÷Ä ’π’•’∂ ’°’æ’•’¨’°÷Å’æ’•’¨:</p>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>‘±’∂’∏÷Ç’∂</th>
                                <th>’Ä’•’º’°’≠’∏’Ω</th>
                                <th>Telegram ID</th>
                                <th>Email</th>
                                <th>‘≤’∏’∂’∏÷Ç’Ω’∂’•÷Ä</th>
                                <th>‘ø’°÷Ä’£’°’æ’´’≥’°’Ø</th>
                                <th>‘≥’∏÷Ä’Æ’∏’≤’∏÷Ç’©’µ’∏÷Ç’∂</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${users.map(user => `
                                <tr>
                                    <td>${user.name}</td>
                                    <td>${user.phone}</td>
                                    <td>${user.telegramId}</td>
                                    <td>${user.email || 'No email'}</td>
                                    <td>÷è ${user.bonuses.toFixed(2)}</td>
                                    <td><span style="color: ${user.status === 'active' ? '#27ae60' : '#e74c3c'}">${user.status}</span></td>
                                    <td>
                                        <button class="btn btn-warning" onclick="editUser(${user.id})">‘Ω’¥’¢’°’£÷Ä’•’¨</button>
                                        <button class="btn btn-danger" onclick="confirmDeleteUser(${user.id})">’ã’∂’ª’•’¨</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            }
        }

        function editUser(id) {
            currentEditingUser = id;
            const user = storage.get('users').find(u => u.id === id);
            const modal = document.getElementById('userModal');
            
            document.getElementById('userModalTitle').textContent = '‘Ω’¥’¢’°’£÷Ä’•’¨ ÷Ö’£’ø’°’ø’•÷Ä’•÷Ä’´’∂';
            document.getElementById('userName').value = user.name;
            document.getElementById('userPhone').value = user.phone;
            document.getElementById('userTelegramId').value = user.telegramId;
            document.getElementById('userBonuses').value = user.bonuses;
            
            modal.style.display = 'block';
        }

        function confirmDeleteUser(id) {
            showConfirmationDialog(
                'Are you sure you want to delete?',
                () => deleteUser(id)
            );
        }

        function deleteUser(id) {
            let users = storage.get('users');
            users = users.filter(u => u.id !== id);
            storage.set('users', users);
            loadUsers();
            loadDashboard();
            showNotification('’ï’£’ø’°’ø’•÷Ä’® ’∞’°’ª’∏’≤’∏÷Ç’©’µ’°’¥’¢ ’ª’∂’ª’æ’•÷Å', 'success');
        }

        function closeUserModal() {
            document.getElementById('userModal').style.display = 'none';
            currentEditingUser = null;
        }

        // User Form Handler
        document.getElementById('userForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('userName').value;
            const phone = document.getElementById('userPhone').value;
            const telegramId = document.getElementById('userTelegramId').value;
            const bonuses = parseFloat(document.getElementById('userBonuses').value) || 0;
            
            let users = storage.get('users');
            
            if (currentEditingUser) {
                const index = users.findIndex(u => u.id === currentEditingUser);
                users[index] = { ...users[index], name, phone, telegramId, bonuses };
                showNotification('’ï’£’ø’°’ø’•÷Ä’® ’∞’°’ª’∏’≤’∏÷Ç’©’µ’°’¥’¢ ’©’°÷Ä’¥’°÷Å’æ’•÷Å', 'success');
            }
            
            storage.set('users', users);
            loadUsers();
            loadDashboard();
            closeUserModal();
        });

        // Reservations Functions
        function loadReservations() {
            const reservations = storage.get('reservations');
            const container = document.getElementById('reservationsList');
            
            if (reservations.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>No Reservations</h3>
                        <p>‘±’¥÷Ä’°’£÷Ä’∏÷Ç’¥’∂’•÷Ä ’π’Ø’°’∂:</p>
                    </div>
                `;
            } else {
                container.innerHTML = reservations.map(reservation => `
                    <div class="reservation-item reservation-${reservation.status.toLowerCase()}">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4>${reservation.userName}</h4>
                                <p><strong>‘æ’°’º’°’µ’∏÷Ç’©’µ’∏÷Ç’∂:</strong> ${reservation.serviceName}</p>
                                <p><strong>‘±’¥’Ω’°’©’´’æ:</strong> ${reservation.date} ${reservation.time}</p>
                                <p><strong>‘ø’°÷Ä’£’°’æ’´’≥’°’Ø:</strong> ${reservation.status}</p>
                                ${reservation.notes ? `<p><strong>’Ü’∑’∏÷Ç’¥’∂’•÷Ä:</strong> ${reservation.notes}</p>` : ''}
                            </div>
                            <div>
                                <button class="btn btn-danger" onclick="confirmDeleteReservation(${reservation.id})">’ã’∂’ª’•’¨</button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function confirmDeleteReservation(id) {
            showConfirmationDialog(
                'Are you sure you want to delete?',
                () => deleteReservation(id)
            );
        }

        function deleteReservation(id) {
            let reservations = storage.get('reservations');
            reservations = reservations.filter(r => r.id !== id);
            storage.set('reservations', reservations);
            loadReservations();
            loadDashboard();
            showNotification('‘±’¥÷Ä’°’£÷Ä’∏÷Ç’¥’® ’∞’°’ª’∏’≤’∏÷Ç’©’µ’°’¥’¢ ’ª’∂’ª’æ’•÷Å', 'success');
        }

        // Password Change Function
        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            
            if (!currentPassword || !newPassword) {
                showNotification('‘Ω’∂’§÷Ä’∏÷Ç’¥ ’•’∂÷Ñ ’¨÷Ä’°÷Å’∂’•’¨ ’¢’∏’¨’∏÷Ä ’§’°’∑’ø’•÷Ä’®', 'error');
                return;
            }
            
            const currentPasswordHash = hashPassword(currentPassword);
            
            if (currentPasswordHash !== adminPassword) {
                showNotification('‘∏’∂’©’°÷Å’´’Ø ’£’°’≤’ø’∂’°’¢’°’º’® ’Ω’≠’°’¨ ’ß', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showNotification('’Ü’∏÷Ä ’£’°’≤’ø’∂’°’¢’°’º’® ’∫’•’ø÷Ñ ’ß ’¨’´’∂’´ ’°’º’∂’æ’°’¶’∂ 6 ’∂’´’∑', 'error');
                return;
            }
            
            const newPasswordHash = hashPassword(newPassword);
            adminPassword = newPasswordHash;
            storage.set('adminPasswordHash', [newPasswordHash]);
            
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            
            showNotification('‘≥’°’≤’ø’∂’°’¢’°’º’® ’∞’°’ª’∏’≤’∏÷Ç’©’µ’°’¥’¢ ÷É’∏’≠’æ’•÷Å', 'success');
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Check for login block on page load
            checkLoginBlock();
            
            // Initialize data
            initializeData();
            
            // Set default password hint
            console.log('Default password: R00T$522166!Adm!n#ARIA*DEV');
            
            // Add keyboard shortcuts for bot commands (for testing)
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.shiftKey) {
                    switch(e.key) {
                        case 'S':
                            e.preventDefault();
                            handleTelegramCommand('/start');
                            break;
                        case 'H':
                            e.preventDefault();
                            handleTelegramCommand('/help');
                            break;
                        case 'R':
                            e.preventDefault();
                            handleTelegramCommand('/services');
                            break;
                        case 'B':
                            e.preventDefault();
                            handleTelegramCommand('/book');
                            break;
                    }
                }
            });

            // Check for existing session
            if (checkExistingSession()) {
                isLoggedIn = true;
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                initializeData();
                loadDashboard();
                resetInactivityTimer();
                showNotification('Welcome back!', 'success');
            }

            // Track user activity
            trackActivity();
        });

        // Close modals when clicking outside
        window.addEventListener('click', function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // ESC to close modals
            if (e.key === 'Escape') {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    modal.style.display = 'none';
                });
                
                // Close confirmation dialogs
                const confirmationDialog = document.querySelector('.confirmation-dialog');
                if (confirmationDialog) {
                    closeConfirmationDialog(false);
                }
            }

            // Enter to send message in chat
            if (e.key === 'Enter' && !e.shiftKey && document.activeElement.id === 'messageInput') {
                e.preventDefault();
                sendMessage();
            }
        });
    </script>
</body>
</html>
